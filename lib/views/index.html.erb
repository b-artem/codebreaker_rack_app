<!DOCTYPE html>
<html>
  <head>
    <title>Codebreaker Rack App</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="stylesheets/application.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  </head>

  <body>

    <div class='container'>

      <section id="start">
        <form method="post" action="/start">
          <button type="submit" class="btn btn-primary">Start new game</button>
        </form>
      </section>

      <section id="guess-section">
        <form id="guess-form" class="form-inline" method="post" action="/submit_guess">
          <div class="form-group">
            <label id="guess-label" for="guess">Enter your guess no. <%= guess_count %>:</label>
            <input id="guess" name="guess" type="text" placeholder="1234" class="form-control">
            <button id="submit-btn" type="submit" class="btn btn-primary">Enter guess</button>
          </div>
        </form>

        <form method="post" action="/hint">
          <button id="hint-btn" type="submit" class="btn btn-success">Take a hint</button>
        </form>
      </section>

      <section id="game-result">
        <% if won? %>
          <div class="alert alert-success">
            <strong>CONGRATULATIONS! You've won the game!</strong>
            You used <%= @game.guess_count %> attempts
            and your score is <strong><%= @game.score %> points.</strong>
            The secret code was <strong><%= @game.secret_code %></strong>
          </div>
        <% end %>

        <% if lost? %>
          <div class="alert alert-danger">
            <strong>You've lost the game!</strong>
            You used <%= @game.guess_count %> attempts
            and your score is <strong><%= @game.score %> points.</strong>
            The secret code was <strong><%= @game.secret_code %></strong>
          </div>
        <% end %>
      </section>

      <section id="info">
        <div id="attempts-hints-info">
          <% if show_hint? %>
            <div class="alert alert-success">
              <strong>HINT: </strong>number <strong><%= secret_number %></strong>
              is in position <strong><%= secret_position %></strong>
            </div>
          <% end %>

          <div class="alert alert-info">
            You have <strong><%= guess_left %></strong> attempts left<br>
            You have <strong><%= hints_left %></strong> hint left
          </div>
        </div>

        <div id="guess-log">
          <% guess_log.each do |guess| %>
            <%= guess %><br>
          <% end %>
        </div>
      </section>

    </div>

    <script>
      $(document).ready(function(){
        <% if won? || lost? %>
          $('#guess, #submit-btn, #hint-btn').prop("disabled", true);
          $('#guess-label').addClass('disabled');
        <% end %>

        <% if hints_left == 'no' %>
          $('#hint-btn').prop("disabled", true);
        <% end %>

        $('#guess').focus();
        $("#guess-form").submit(function(){
          pattern = /^[1-6]{4}$/
          var guess = $('#guess').val();
          var res = pattern.test(guess);
          if (res == false) {
            alert("Code must contain 4 numbers from 1 to 6. Please try again");
          }
        });
      });
    </script>

  </body>
</html>
